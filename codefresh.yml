version: '1.0'

steps:

  build-prj:
    type: build
    description: UC - build step
    working-directory: ${{initial-clone}}
    image-name: codefreshio/yaml-example
    dockerfile: Dockerfile
    tag: ${{CF_BRANCH}}

  build-snyk:
    type: build
    image-name: codefreshio/snyk
    dockerfile: snyk/Dockerfile
    tag: latest

  snyk-test:
    image: ${{build-snyk}}
    working-directory: ${{initial-clone}}
    fail-fast: false
    commands:
      - npm install
      - echo start snyk test
      - snyk auth $SNYK_TOKEN
      - snyk test
    environment:
      - SNYK_TOKEN=${{AUTH_TOKEN}}