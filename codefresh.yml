version: '1.0'

steps:
  build-prj:
    type: build
    description: UC - push to aws
    image-name: codefreshio/test
    dockerfile: Dockerfile
    tag: latest

  push-step:
    type: push
    description: Free text description
    candidate: ${{build-prj}}
    tag: ${{CF_BRANCH}}
    registry: ${{AWS_REGISTRY}}
    credentials:
      username: ${{AWS_USERNAME}}
      password: ${{AWS_PASSWORD}}
    fail-fast: false

#  deploy to ecs:
#     image: codefresh/cf-deploy-ecs
#     commands:
#       - cfecs-update --image-name codefreshio/test --image-tag ${{CF_BRANCH}} eu-west-1 demochat-production demochat-service
#     environment:
#       - AWS_ACCESS_KEY_ID=${{AWS_ACCESS_KEY_ID}}
#       - AWS_SECRET_ACCESS_KEY=${{AWS_SECRET_ACCESS_KEY}}
#     when:
#      branch:
#        only:
#          - staging