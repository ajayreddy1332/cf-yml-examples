version: '1.0'
steps:
  build_prj1:
    type: build
    image_name: qwerty1
    fail-fast: true
    metadata:
      set:
          - commit_message: ${{CF_COMMIT_MESSAGE}}
          - test_name: qwerty
          - is_tested: true
          - command:
              evaluate: "'${{CF_BRANCH}}'=='condition-step'"
  push_step:
    description: Pushing image to Docker hub.
    type: push
    candidate: ${{build_prj1}}
    tag: ${{CF_BRANCH}}
    fail-fast: false
    on_success:
      metadata:
        set:
          - ${{build_prj.imageId}}:
            - push_step_status: true
    on_fail:
      metadata:
        set:
          - ${{build_prj.imageId}}:
            - push_step_status: false

#  freestyle_step:
#    image: node:latest
#    commands:
#      - echo test
#    on_success:
#      metadata:
#        set:
#          - ${{build_prj.imageId}}:
#            - is_unit_test: true
#    on_fail:
#      metadata:
#        set:
#          - ${{build_prj.imageId}}:
#            - is_unit_test: false

#  composition_step:
#    description: Attempting to run as part of composition.
#    type: composition
#    composition:
#      version: '2'
#      services:
#        app:
#          image: 'advance512demo/demochat:master'
#          ports:
#            - 5000
#          depends_on:
#            - mongo
#        mongo:
#          image: mongo
#    composition-candidates:
#      main:
#        image: nhoag/curl
#        command: bash -c "sleep 20 && curl http://app:5000/" | echo 'works'
#    when:
#      condition:
#        any:
#          noSkipCiInCommitMessage: 'includes(lower("${{CF_COMMIT_MESSAGE}}"), "skip ci") == false'
#          notFeatureBranch: 'match("${{CF_BRANCH}}", "^FB-", true) == false'
#    metadata:
#      set:
#        - commit_message: ${{CF_COMMIT_MESSAGE}}
#        - test_name: qwerty
#        - is_tested: true
#        - command:
#            evaluate: "'${{CF_BRANCH}}'=='condition-step'"

#  push_step:
#    description: Pushing image to Docker hub.
#    type: push
#    candidate: ${{build_prj}}
#    tag: ${{CF_BRANCH}}
#    fail-fast: false


#  launch_compose:
#    type: launch-composition
#    when:
#      branch:
#        ignore: [ master, other]
#    composition:
#        version: '2'
#        services:
#          app:
#            image: ${{build_prj}}
#            ports:
#              - 3000
#    metadata:
#      set:
#        - commit_message: ${{CF_COMMIT_MESSAGE}}
#        - test_name: qwerty
#        - is_tested: true
#        - command:
#            evaluate: "'${{CF_BRANCH}}'=='condition-step'"


