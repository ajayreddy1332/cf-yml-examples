version: '1.0'
steps:
    build-step:
      type: build
      image_name: codefreshio/yaml-example
      dockerfile: Dockerfile
      tag: ${{CF_BRANCH}}

    step-file-generation:
      type: composition
      composition:
        version: '2'
    	services:
          service-name:
            image: ${{build-step}}
            command: bash -c "ls -l && cd /codefresh && ls -l && echo test:$MYSQL_ROOT_PASSWORD"
    		volumes:
              - ${{CF_VOLUME}}:/codefresh/volume
        volumes:
          ${{CF_VOLUME}}:
            external: true
      composition-candidates:
        test:
          image: ${{build-step}}
          command: echo test:$MYSQL_ROOT_PASSWORD
          env_file: /codefresh/volume/cf-yml-examples/mysql.env
    	  volumes:
            - ${{CF_VOLUME}}:/codefresh/volume


#    check_env_file_:
#      type: composition
#      working_directory: ${{main_clone}}
#      composition:
#        version: '2'
#        services:
#          db:
#            image: mysql:latest
#            volumes:
#              - ${{CF_VOLUME}}:/codefresh/volume
#            ports:
#              - 3306
#            environment:
#              MYSQL_ROOT_PASSWORD: admin
#              MYSQL_USER: my_user
#              MYSQL_PASSWORD: admin
#              MYSQL_DATABASE: nodejs
#        volumes:
#          ${{CF_VOLUME}}:
#            external: true
#      composition_candidates:
#          test:
#            image: node:latest
#            command: bash -c 'ls -l && cd /codefresh && ls -l && echo test:$MYSQL_ROOT_PASSWORD'
##            env_file: /codefresh/volume/cf-yml-examples/mysql.env